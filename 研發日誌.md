# 天空冒險者公會 - 研發日誌

## 2025-01-27 (下午)
### 自動等級晉升系統實作
- **自動等級晉升邏輯**
  - 新增 `check_and_upgrade_level()` 函數
  - 根據總積分（未使用積分 + 已使用積分）自動計算等級
  - 支援 11 個等級的晉升：木級 → 鐵級 → 銅級 → 銀級 → 金級 → 白金級 → 黑鋼級 → 秘銀級 → 山鐵級 → 神金級 → 傳說級

- **觸發時機**
  - 任務審核通過時自動檢查等級晉升
  - 徽章頒發獲得額外積分時自動檢查等級晉升
  - 確保積分變動時立即更新等級

- **使用者體驗優化**
  - 等級晉升時顯示成功通知（🎉 等級晉升！）
  - 通知訊息包含從舊等級到新等級的晉升資訊
  - 通知可手動關閉，支援多個通知同時顯示
  - 統一的奇幻主題視覺風格

- **技術實現**
  - 等級對應積分：0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000
  - 自動找出符合當前積分的最高等級
  - 避免重複晉升，只在等級真正變化時更新
  - 資料庫事務確保資料一致性

## 2025-01-27
### 成就徽章系統完整實作
- **資料庫模型建立**
  - 新增 Badge 模型（徽章基本資訊）
  - 新增 UserBadge 模型（使用者徽章關聯）
  - 支援徽章圖片上傳與儲存
  - 包含解鎖條件、目標次數、額外積分等欄位

- **管理員後台功能**
  - 完成成就徽章管理頁面 (`/admin/badges`)
  - 支援新增、編輯、刪除徽章功能
  - 徽章圖片上傳與預覽功能
  - 徽章啟用/停用狀態管理
  - 在所有管理員頁面選單中統一新增「成就徽章管理」連結

- **前台展示功能**
  - 完成成就徽章總覽頁面 (`/badges`)
  - 徽章圖片點擊放大功能（Modal 視窗顯示原始比例）
  - 滑鼠懸停動畫效果與視覺回饋
  - 徽章詳細資訊顯示（名稱、描述、解鎖條件等）

- **自動頒發邏輯**
  - 任務完成時自動檢查徽章解鎖條件
  - 支援基於任務完成次數的徽章解鎖
  - 解鎖時自動頒發額外積分獎勵
  - 避免重複頒發相同徽章

- **使用者體驗優化**
  - 徽章圖片互動效果（縮放、陰影）
  - Modal 視窗居中顯示，支援響應式設計
  - 統一的奇幻主題視覺風格
  - 完整的錯誤處理與使用者提示

### 技術改進
- 資料庫結構優化，支援徽章系統完整功能
- 前端 JavaScript 互動功能增強
- Bootstrap Modal 組件整合
- 圖片處理與儲存機制完善

## 2024-03-21
### 功能優化
- 優化首頁任務列表的篩選與排序功能
  - 新增多條件篩選（等級、團體/個人、任務類型）
  - 支援表格欄位點擊排序
  - 優化 UI/UX 體驗
- 重新設計首頁積分顯示區塊
  - 將積分資訊移至圖片右側
  - 優化視覺排版與響應式設計

### 技術方案評估
- 評估單機部署方案
  - PyInstaller 打包方案
  - Electron 桌面應用方案
  - Docker 容器化方案
  - Inno Setup 安裝程式方案
- 決定採用 PyInstaller + Inno Setup 組合方案
  - 適合家庭用戶使用
  - 提供專業安裝體驗
  - 支援自動更新功能

## 2024-03-20
### 架構調整
- 將專案架構從前後端分離改為 Flask + Jinja2
- 簡化部署流程，提升使用者體驗
- 優化資料庫結構與查詢效能

### 功能開發
- 完成基本使用者認證系統
- 實作任務管理功能
- 開發積分系統
- 建立管理員後台

## 2024-03-19
### 專案初始化
- 建立專案基礎架構
- 設計資料庫模型
- 實作基本 API
- 開發前端介面

### 技術選型
- 後端：Flask + SQLite
- 前端：Jinja2 + Bootstrap
- 資料庫：SQLite
- 認證：Flask-Login

1. 更新專案與 GitHub 連結
2. 設定應用程式 host 為 0.0.0.0，使其能夠從外部訪問
3. 更新 README.md 文件
4. 確認專案 IP 設定為 192.168.50.67:5000
5. 新增成就徽章總覽頁面（/badges）
6. 在所有冒險者選單中新增成就徽章連結
7. 調整成就徽章頁面表格設計風格，與其他頁面保持一致
8. 修改冒險者個人檔案頁面，積分顯示改為總積分
9. 距離下一級積分計算也改為以總積分為基準

## 待辦事項
1. 實作 PyInstaller 打包腳本
2. 開發 Inno Setup 安裝程式
3. 加入自動更新功能
4. 優化資料庫效能
5. 加強安全性措施
6. 開發更多任務類型
7. 實作獎勵兌換系統
8. 加入數據統計功能

## 技術債務
1. 需要優化大量資料的查詢效能
2. 需要加強錯誤處理機制
3. 需要完善日誌記錄系統
4. 需要加強資料備份機制
5. 需要優化圖片上傳功能

## 一、專案計畫簡述
本專案為「家庭獎勵遊戲平台」，目標是協助家庭成員透過完成任務獲得積分，並由管理員（家長）審核與管理，促進家庭互動與正向激勵。

- 冒險者可註冊、登入、查看任務、完成任務並累積積分。
- 管理員可管理任務、審核任務、管理冒險者。
- 平台採用 Flask + SQLite + Bootstrap + Jinja2 技術棧。
- 支援冒險者等級與徽章系統（11級，對應專屬徽章與說明，徽章可點擊放大預覽）。
- 管理員/冒險者選單動態切換（管理員選單於左側，冒險者選單於導覽列下拉）。
- 全站奇幻主題 UI 美化與互動。

## 二、目前研發進度
- [x] 專案初始化與基本環境建置
- [x] 冒險者（原使用者）註冊、登入、登出功能
- [x] 任務資料庫模型與基本操作（含任務等級、團體任務、任務類型）
- [x] 任務完成記錄與積分系統（含積分狀態顯示）
- [x] 管理員帳號自動建立
- [x] 管理員儀表板、任務管理、冒險者管理（含等級、積分、狀態）、任務審核頁面模板
- [x] 管理員權限驗證與後台路由
- [x] 管理員登入自動導向後台
- [x] 任務審核流程優化（審核通知、歷史查詢、積分於審核通過時才扣除）
- [x] 積分兌換獎勵功能（含前後台、審核流程、積分檢查與狀態顯示）
- [x] 全站奇幻主題 UI 美化（色彩、字體、背景、卡片、按鈕、徽章、側邊欄等）
- [x] 首頁與積分兌換頁顯示「總積分｜已使用｜未使用」
- [x] 名詞統一（冒險者、任務等）與圖片配置（登入主視覺）
- [x] 冒險者等級說明頁與徽章互動（可點擊放大）
- [x] 管理員/冒險者選單動態切換（管理員左側、冒險者導覽列）
- [x] Jinja2 模板結構優化與 block 重複定義錯誤修正
- [x] 冒險者個人頁與成就徽章系統
- [x] 冒險者個人檔案頁面（顯示頭像、等級、積分、升級進度、成就徽章、近期任務紀錄）
- [x] 冒險者等級晉級積分與進度條顯示
- [x] bug 修正（Jinja2 block 重複定義、變數未定義、zfill filter 不支援等）
- [x] 儀表板待審核任務數量查詢邏輯優化
- [ ] 前端介面進一步優化與行動裝置體驗提升
- [ ] 單元測試與文件補充
- [ ] 統計報表與數據分析功能
- [ ] 通知系統（Email/LINE）
- [ ] 多家庭/公會分組管理

## 三、預計進行項目
1. 優化前端 UI/UX，提升行動裝置體驗（RWD、互動動畫、主題細節）
2. 增加統計報表與數據分析功能（任務完成率、積分流向、冒險者活躍度等）
3. 撰寫單元測試與補充開發文件（API、資料庫、前端元件）
4. 部署至雲端平台並開放家庭成員實測
5. 增設通知系統（如 Email/LINE 通知審核結果）
6. 支援多家庭/公會分組管理
7. 增加冒險者個人頁與成就徽章系統

## 2025/06/13

### 一、目前專案進度

1. **基本功能與主題**
   - 完成前後台分離，Flask + Jinja2 + SQLite + Bootstrap，奇幻公會主題。
   - 冒險者註冊/登入、任務管理、積分系統、管理員審核、積分兌換、等級與徽章、UI 美化等功能皆已上線。

2. **管理員功能**
   - 管理員可管理任務、冒險者、審核任務、管理獎勵與兌換審核。
   - 管理員選單已改為下拉式選單，操作更便利。

3. **冒險者功能**
   - 冒險者可查看任務、完成任務、查詢積分與任務紀錄、申請積分兌換、查看等級說明與個人角色頁。
   - 冒險者個人檔案頁面已完成，支援頭像上傳、等級進度、成就徽章顯示。

4. **資料庫與邏輯**
   - User、Task 模型已擴充必要欄位。
   - 積分兌換、任務審核等邏輯優化，確保資料正確性。

5. **UI/UX**
   - 全站統一奇幻主題，色彩、字體、卡片、按鈕、徽章等細節皆美化。
   - 任務管理、獎勵管理頁面已加入前端篩選與排序功能。

6. **錯誤修正與優化**
   - 多次修正 Jinja2 block、變數未定義、zfill filter 等錯誤。
   - 後端補充必要變數，前端模板調整顯示邏輯。

7. **文件同步**
   - README 與研發日誌已同步專案最新進度與功能。

---

### 二、建議後續進行項目

1. **通知與提醒系統**
   - 新增任務審核、兌換審核等即時通知（如頁面提示或 email）。

2. **權限與安全性強化**
   - 增加密碼強度檢查、登入失敗鎖定、CSRF 防護等安全措施。

3. **API 與前端分離（進階）**
   - 若有 SPA 或行動端需求，可考慮將後端 API 化，前端用 Vue/React 重構。

4. **活動與成就系統**
   - 增加特殊活動、限時任務、更多成就徽章，提升遊戲化體驗。

5. **數據分析與報表**
   - 管理員後台增加積分、任務、兌換等統計圖表，方便家長追蹤成效。

6. **多語系支援**
   - 若有國際化需求，可加入多語系切換。

7. **UI/UX 持續優化**
   - 根據實際使用者回饋，持續調整版面與互動細節。

8. **自動化測試與 CI/CD**
   - 增加單元測試、整合測試，並串接自動化部署流程。

---

> 本日誌將持續更新專案進度與規劃。 